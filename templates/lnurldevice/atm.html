<!--/////////////////////////////////////////////////-->
<!--////////////////USER FACING PAGE/////////////////-->
<!--/////////////////////////////////////////////////-->

{% extends "public.html" %} {% block page %}
<div class="row q-col-gutter-md justify-center">
    <div class="col-12 col-sm-6 col-md-5 col-lg-4">
        <q-card class="q-pa-lg">
            <q-card-section class="q-pa-none">

                <q-tabs v-model="tab" active-color="primary" align="justify">

                    <q-tab name="lnurl" label="lnurl" @update="val => tab = val.name"></q-tab>

                    <q-tab name="ln" label="lightnig" @update="val => tab = val.name"></q-tab>

                    <q-tab :disable="boltz == 'None'" name="onchain" label="onchain"
                        @update="val => tab = val.name"></q-tab>

                    <q-tab :disable="boltz == 'None'" name="liquid" label="liquid"
                        @update="val => tab = val.name"></q-tab>
                </q-tabs>
                <q-separator></q-separator>

                <q-tab-panels v-model="tab">
                    <q-tab-panel name="lnurl">
                        <div class="text-h6">LNURL Withdraw</div>
                        <div class="text-center">
                            <a class="text-secondary" :href="'lightning:' + qr_value">
                                <q-responsive :ratio="1" class="q-mx-md">
                                    <qrcode :value="qr_value" :options="{width: 800}" class="rounded-borders"></qrcode>
                                </q-responsive>
                            </a>
                        </div>

                        <div class="row q-mt-lg q-gutter-sm">
                            <q-btn outline color="grey" @click="copyText(qr_value, 'LNURL copied to clipboard!')">Copy
                                LNURL </q-btn>
                        </div>
                    </q-tab-panel>
                    <q-tab-panel name="ln">
                        <div class="text-h6">Lightning Withdraw</div>
                        <div class="text-center">
                            <a class="text-secondary" :href="'lightning:' + qr_value">
                                <q-responsive :ratio="1" class="q-mx-md">
                                    <qrcode :value="qr_value" :options="{width: 800}" class="rounded-borders"></qrcode>
                                </q-responsive>
                            </a>
                        </div>

                        <div class="row q-mt-lg q-gutter-sm">
                            <q-btn outline color="grey" @click="copyText(qr_value, 'Invoice copied to clipboard!')">Copy
                                LNURL </q-btn>
                        </div>
                    </q-tab-panel>

                    <q-tab-panel name="lnaddress">
                        <div class="text-h6">LNAddress</div>
                        <div class="q-pa-md">
                            <form @submit.prevent="sendLNaddress">
                                <q-input filled v-model="lnaddress" label="Enter your LNAdress" />
                                <q-btn type="submit" color="primary" label="Submit" class="q-mt-md" />
                            </form>
                        </div>
                    </q-tab-panel>

                    <q-tab-panel name="onchain" :disable="boltz == 'None'">
                        <div class="text-h6">Onchain Withdraw</div>
                        <div class="text-center">
                            <a class="text-secondary" :href="'lightning:' + qr_value">
                                <q-responsive :ratio="1" class="q-mx-md">
                                    <qrcode :value="qr_value" :options="{width: 800}" class="rounded-borders"></qrcode>
                                </q-responsive>
                            </a>
                        </div>

                        <div class="row q-mt-lg q-gutter-sm">
                            <q-btn outline color="grey" @click="copyText(qr_value, 'Address copied to clipboard!')">Copy
                                LNURL </q-btn>
                        </div>
                    </q-tab-panel>

                    <q-tab-panel name="liquid" :disable="boltz == 'None'">
                        <div class="text-h6">Liquid Withdraw</div>
                        <div class="text-center">
                            <a class="text-secondary" :href="'lightning:' + qr_value">
                                <q-responsive :ratio="1" class="q-mx-md">
                                    <qrcode :value="qr_value" :options="{width: 800}" class="rounded-borders"></qrcode>
                                </q-responsive>
                            </a>
                        </div>

                        <div class="row q-mt-lg q-gutter-sm">
                            <q-btn outline color="grey" @click="copyText(qr_value, 'Address copied to clipboard!')">Copy
                                LNURL </q-btn>
                        </div>
                    </q-tab-panel>
                </q-tab-panels>

            </q-card-section>

        </q-card>
    </div>
    <div class="col-12 col-sm-6 col-md-5 col-lg-4 q-gutter-y-md">
        <q-card>
            <q-card-section>
                <h6 class="text-subtitle1 q-mb-sm q-mt-none">ATM Withdraw</h6>
                <p class="q-my-none">
                    Boltz powered withdrawals for onchain and liquid.
            </q-card-section>
            <q-card-section class="q-pa-none">
                <q-separator></q-separator>
                <q-list> </q-list>
            </q-card-section>
        </q-card>
    </div>
</div>
{% endblock %} {% block scripts %}
<script>
    Vue.component(VueQrcode.name, VueQrcode)

    new Vue({
        el: '#vue',
        mixins: [windowMixin],
        delimiters: ['${', '}'],
        data: function () {
            return {
                device_id: '{{device_id}}',
                qr_value: '{{lnurl}}',
                lnurl: '{{lnurl}}',
                boltz: '{{boltz}}',
                p: '{{p}}',
                tab: 'lnurl',
                lnaddress: '',
                payment_options: ['lnurl', 'ln', 'lnaddress', 'onchain', 'liquid'],
            }
        },
        methods: {
            launchFunction: function () {
                // Your function logic here
                console.log('launchFunction called because tab is lightning');
            },
            sendLNaddress: function () {
                LNbits.api
                    .request(
                        'GET',
                        '/lnurldevice/api/v1/lnaddress/' + this.device_id + '/' + this.p + '/' + this.lnaddress,
                        ''
                    )
                    .then(function (response) {
                        if (response.data) {
                            $q.notify({
                                message: 'LNAddress sent, payment should be with you shortly',
                                color: 'green'
                            })
                        }
                    })
                    .catch(function (error) {
                        LNbits.utils.notifyApiError(error)
                    })
            }
        },
        created: function () {
            console.log(this.boltz)
        },
        watch: {
            tab: function (newVal, oldVal) {
                if (newVal === 'ln') {
                    this.launchFunction()
                }
            }
        }


    })
</script>
{% endblock %}